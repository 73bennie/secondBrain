#!/usr/bin/env bash
set -euo pipefail
DB="${SB_DB:-$HOME/.secondbrain/brain.db}"

if [[ $# -ne 2 ]]; then
  echo "Usage: sb-project-status <project_id> active|waiting|blocked|someday|done"
  exit 1
fi

pid="$1"
status="$2"

if ! [[ "$pid" =~ ^[0-9]+$ ]]; then
  echo "project_id must be a number"
  exit 1
fi

case "$status" in
  active|waiting|blocked|someday|done) ;;
  *)
    echo "Invalid status: $status"
    echo "Use: active|waiting|blocked|someday|done"
    exit 1
    ;;
esac

sqlite3 "$DB" <<SQL
UPDATE projects SET status='$status', updated_at=datetime('now') WHERE id=$pid;
INSERT INTO log_events (event, details) VALUES ('project_status', 'project $pid -> $status');
SQL

echo "project $pid status set to $status"
